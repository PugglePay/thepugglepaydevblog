<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[PugglePay]]></title>
  <link href="http://devblog.pugglepay.com/atom.xml" rel="self"/>
  <link href="http://devblog.pugglepay.com/"/>
  <updated>2015-04-16T14:49:03+02:00</updated>
  <id>http://devblog.pugglepay.com/</id>
  <author>
    <name><![CDATA[dev]]></name>
    <email><![CDATA[dev@pugglepay.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[The whys of reviewing]]></title>
    <link href="http://devblog.pugglepay.com/blog/2015/04/16/the-whys-of-reviewing/"/>
    <updated>2015-04-16T14:42:00+02:00</updated>
    <id>http://devblog.pugglepay.com/blog/2015/04/16/the-whys-of-reviewing</id>
    <content type="html"><![CDATA[<p>The other week we talked about reviews, why do we do them, what do we look at,
and what do we get out of it.</p>

<p>What we didn&#8217;t really discuss was the technical hows, these details come down to
your own style. Some people like seeing the changes in increments, in a commit
by commit view, some like to see the sum of changes in all their glory. This
might be another meeting and another blog post.</p>

<p>The answer here might seem obvious, but it&#8217;s nice to restate even the given
answers. Maybe we find out that our set of reasons is larger than we think.</p>

<!-- more -->


<h2>Being right</h2>

<p>Correctness is the obvious answer, and it&#8217;s a good one. I don&#8217;t know about you, but here at Zimpler we are all fallible humans, and a
second set of eyes is always useful.</p>

<p>This is what I like to think of as the &#8216;objective&#8217; part of the review. Either
your code does what it should do, or it doesn&#8217;t. Either your tests cover the
edge cases or they don&#8217;t.</p>

<p>The points we collected under this heading were:
- Does the code do what it&#8217;s supposed to?
  - Does it follow the specification?
  - Do the tests test the right stuff?
- Does the code avoid breaking the rest of the system?
  - Will the performance be good enough?
  - Will the implementation break any expectations present in other parts of the</p>

<pre><code>code?
</code></pre>

<ul>
<li>Does the code directly contradict any planned changes?</li>
</ul>


<p>If the code does not measure up on these points, it&#8217;s pretty much going to get rejected, no
discussion.</p>

<p>I&#8217;d like to take an extra look at the final point: Planned Changes. Maybe you&#8217;ve
been locked in your office for a week working on this feature, maybe another
team is working on something you aren&#8217;t really aware of. And maybe your
implementation will make thigns very hard for them.
When this happend, you really have to think about who gets priority, and how to
accomodate each other. You might not be wrong, but you might still have to
change.
In the end, any change will close some doors in the future while opening others.
The thing you want to prevent here is direct conflicts with planned changes, not
theoretical future strawmen. As a reviewer you should be reasonable in your
expectations of the implementers soothsaying capabilities and aware of your own.</p>

<h2>Being read</h2>

<p>Even if your code is correct, it might not be obviously so. As I mentioned
we&#8217;re all humans here, and we do copmlicated work, so any help is appreciated in
understanding each others.</p>

<p>This is a much more subjective side of the process. This is where you get into
heated disscussions about names, line breaks and bikeshed colors, but it&#8217;s still
important!</p>

<p>Some points we lined up under this heading:
- Help minimize technical debt.
- Check readbility/understandability/styling.</p>

<p>Restating the above, even if you&#8217;re right, your code might still be bad, the
mitigating factor is that you might not be aware of it. Your reviewer is
responsible for pointing out your nasty hacks, your convoluted logical
constructs and your ugly bikesheds.</p>

<p>For these kind of things, we won&#8217;t immediatley reject a story. Changes of this
kind are often relatively minor and clear, so bouncing them back and forth often
solves it in less time than restarting the story.</p>

<p>Quite often you even get to prove your reviewer wrong, which is always a nice
feeling.</p>

<h2>Becoming enlightened</h2>

<p>So what do we get out of all this?</p>

<h3>Primary results</h3>

<p>From the first part of the review, we get a working system, reasonable
performance and a clear way forward.
The code does its job without getting in the way of everyone else.</p>

<p>In the second part we make sure to pave the way for more general future
improvements. By reducing quirks, complications and unexpected behaviour we make
it easier to get things done for future us.</p>

<h3>Gazing into the abyss</h3>

<p>Apart from the review&#8217;s positive effects on the code, the review also improves
the reviewer, as well as the reviewee!</p>

<p>Reading code is extremely important, it gives you both a better understanding of
the code base you have, just from looking at parts your not currently working
with. It also works as a puzzle, where you have to understand a different
persons style of writing code.</p>

<h3>Talking to your friends</h3>

<p>While reading code is important, discussing code is vital. By critiquing and
analyzing the code of your fellow programmers, you invite discussion on both
design choices and styling.</p>

<p>Discussion almost always leads to learning and that&#8217;s our final fringe benefit
in the review process.</p>

<h2>Reviewing should be fun</h2>

<p>Revieweing improves your company in multiple ways beyond just the code. So make
sure you do it well, be clear and honest in your review comments, and try to
learn as much as you can as you go along.</p>

<p>I&#8217;m planning to schedule another meeting to follow this up, on how to review
code, and to how to help others review yours. After that I hope to do another
blog post.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Where is my stack? (Part 1): Goodbye Torquebox]]></title>
    <link href="http://devblog.pugglepay.com/blog/2013/10/09/where-is-my-stack-part-1-torquebox/"/>
    <updated>2013-10-09T13:30:00+02:00</updated>
    <id>http://devblog.pugglepay.com/blog/2013/10/09/where-is-my-stack-part-1-torquebox</id>
    <content type="html"><![CDATA[<p>So this is how it ends.</p>

<p>This week was the last week we ran TorqueBox in production. We&#8217;ve had
it running in production for 5 months. That&#8217;s something! We
switched to TorqueBox in the first place to avoid headache with system
administration. Sadly, There Ain&#8217;t No Such Thing As A Free Lunch
(TANSTAAFL), and we traded our problems with new ones, namely JRuby
and the JVM.</p>

<!-- more -->


<h2>Previously on &#8220;PugglePay&#8221;</h2>

<p>In an <a href="http://devblog.pugglepay.com/blog/2013/05/03/torquebox-or-how-i-learned-to-stop-worrying-and-love-the-jvm/">earlier post</a>, I discussed some problem we had with TorqueBox from the very
beginning, but that we thought could overcome:</p>

<ul>
<li>slower tests</li>
<li>memory leaks</li>
<li>no zero-downtime deploy</li>
</ul>


<p>The only problem that was solved (and only recently) was the zero
downtime deploy. Other problems have appeared in the meantime:</p>

<ul>
<li>gem incompatibility</li>
<li>shaky OpenSSL support</li>
<li>very tricky setup with Spork</li>
<li>assets pre-compile that take forever</li>
</ul>


<h2>What to do?</h2>

<p>Most of those problems are related to JRuby, and I&#8217;m confident that
they will be solved someday. Another thing to point out is that we
migrated a fairly large application, so it might be easier to spot
memory leaks when building an app from the ground up.</p>

<p>But for our case, we reached the conclusion that TorqueBox was not a
good fit given our current needs, and went therefore the other way.</p>

<p>And that meant the Unix way.</p>

<p>Instead of adding the one big component, we&#8217;ve had to add a bunch of
smaller ones. We are now using Nginx+Passenger Enterprise as web-server,
Redis+Resque+resque_scheduler for cluster-wise scheduling, and Monit for
keeping all those services running.</p>

<p>So we did not want to become full-blown sysadmin, but that became the
only viable option for us.</p>

<p>We were only treating the symptom though, and not the decease: we did
not want to become Sysadmins because the tooling we&#8217;ve been using for
system administration were so painful to use.</p>

<p>So that&#8217;s how it all began: with looking for a replacement for our
own mixture of ruby scripts and Chef recipes&#8230;</p>

<h2>On the next episode of PugglePay Development</h2>

<p>The team learns new encryption techniques (&#8220;We should totally use
GPG!&#8221;), discover new tools (&#8220;Ansible all the things!&#8221;) and write some
libraries (&#8220;Mr. F~~&#8221;).</p>
<div class='octopress-authorbox'>
  <div class="author-pic">
    <img src="http://www.gravatar.com/avatar/c7a730fdb6c64f65ff18a5e74e60b4df" alt="Jean-Louis Giordano" />
  </div>

  <div class="author-about">
    <h3>Jean-Louis Giordano</h3>
    <ul class="author-links">
      
      <li>Passionate Developer</li>
      

      
      <li><a href="mailto: ">jean-louis@pugglepay.com</a></li>
      

      
      <li>
        <a href="https://twitter.com/jellismymind" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @jellismymind</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      
    </ul>
  </div>
</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pair Programming in the Cloud]]></title>
    <link href="http://devblog.pugglepay.com/blog/2013/05/28/pair-programming-in-the-cloud/"/>
    <updated>2013-05-28T21:53:00+02:00</updated>
    <id>http://devblog.pugglepay.com/blog/2013/05/28/pair-programming-in-the-cloud</id>
    <content type="html"><![CDATA[<p>At PugglePay, we like to program in pairs. When everyone is working in
the same office, that&#8217;s pretty easy: we just share a computer, and use
whatever text editor the owner of the computer has (in our case
Emacs, Vim or Sublime Text 2).</p>

<p>But things get complicated when one of the developper decides to move
abroad for a couple of months&#8230;</p>

<!-- more -->


<h2>First attempt: No Pair Programming</h2>

<p>Well, the easiest solution is simply to stop pair programming and
simply review each other&#8217;s code. But we observed that it&#8217;s really more
difficult to solve problems in a simple and elegant way while
programming on your own. One is also more reluctant to fix broken
windows on code that is already written.</p>

<p>So I guess that&#8217;s not a viable solution. Pair programming is great,
and passing on it simply because we are not in the same place is just
too sad.</p>

<h3>Pros:</h3>

<ul>
<li>Trivial to setup</li>
</ul>


<h3>Cons:</h3>

<ul>
<li>Makes me a sad panda</li>
</ul>


<h2>Second attempt: Screen Sharing</h2>

<p>The simple approach is to simply run some sort of screen
sharing application. We have been using
<a href="http://screenhero.com/">Screen Hero</a>, which is really awesome. Each
user that joins a Screen Hero session gets his own cursor with his
name on it. In addition to that, we run google hangouts or Skype to
talk to each other.</p>

<p>This works great, except that there is some lag for the users that are
not hosting the session, and the quality of the video is not perfect.
Spending most of the day writting code with an image full of
compression artifact, even minors, is pretty painfull.</p>

<p>Also, since we recently migrated to JRuby, some of us still use a
not so powerful MacBook Air, running Skype + Screen Hero + Spork +
Nailgun + Chrome made our computers really, REALLY slow.</p>

<p>So that didn&#8217;t work for us, but if you have access to a really good
internet connection and powerfull computers, this might be the best
solution.</p>

<h3>Pros:</h3>

<ul>
<li>Easy to setup</li>
<li>Fancy cursors for everyone</li>
</ul>


<h3>Cons:</h3>

<ul>
<li>Slow</li>
<li>Compression artifacts</li>
</ul>


<h2>Third attempt: AWS + SSH + tmux + Emacs</h2>

<p>Inspired by other remote-working companies like
<a href="http://thinkrelevance.com/">Relevance</a>, we decided to try a
combination of SSH, tmux and Emacs. To make things easier, we decided
to setup all that on a High CPU Amazon EC2 instance.</p>

<p>To share sessions with <a href="http://tmux.sourceforge.net/">tmux</a>, we use
<a href="https://github.com/zolrath/wemux">wemux</a>, which is a small wrapper
around tmux to simplify multi-user sessions.</p>

<p>I order to work with git, we simply need to active Agent Forwarding
when we ssh in to the instance. It&#8217;s also interesting to setup some
port forwarding when we want to run <code>rails server</code>.</p>

<p>To do that automatically, we just configured a host in our local
<code>~/.ssh/config</code> that look something like that:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ServerAliveInterval 60
</span><span class='line'>
</span><span class='line'>Host pp
</span><span class='line'>  HostName pair-programming.pugglepay.net.
</span><span class='line'>  User pair
</span><span class='line'>  ForwardAgent yes
</span><span class='line'>  LocalForward 3000 127.0.0.1:3000
</span></code></pre></td></tr></table></div></figure>


<p>And then we just have to <code>ssh pp</code> to access the instance.</p>

<p>We met some problem when running Emacs from the terminal, since the
meta key (the <code>cmd</code> button on mac) is not properly interpreted. Also,
<code>C-&lt;left&gt;</code> and <code>C-&lt;right&gt;</code> were not properly recognized.</p>

<p><a href="http://www.iterm2.com/#/section/home">iTerm 2</a> solved the first
problem. In the preference panel, under Profiles/Keys, select &#8220;Left
otion key acts as +Esc&#8221;. Now we can use the <code>alt</code> key as the meta key.</p>

<p>We solved the second problem within emacs, by mapping the ASCII escape
sequence received from <code>C-&lt;direction&gt;</code> to <code>C-&lt;direction&gt;</code>. That&#8217;s what
we added to our <code>~/.emacs/init.el</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(global-set-key (kbd "M-[ c") (kbd "C-&lt;right&gt;"))
</span><span class='line'>(global-set-key (kbd "M-[ d") (kbd "C-&lt;left&gt;"))
</span><span class='line'>(global-set-key (kbd "M-[ a") (kbd "C-&lt;up&gt;"))
</span><span class='line'>(global-set-key (kbd "M-[ b") (kbd "C-&lt;down&gt;"))</span></code></pre></td></tr></table></div></figure>


<p>This solution is pretty nice, but it restricts us to Emacs, vim, or
editors that can be run in a terminal. It also requires a lot of
effort to setup. We also get the super annoying scrolling with tmux
( <code>C-b [</code>, is there a better way?).</p>

<p>It might have been easier to setup tmux with vim instead, but we have
a much more efficient workflow with emacs at the moment.</p>

<p>Though a nice side-effect of developping on the exact same type of
instance that we deploy our application to is that we find bugs that
we might have missed while developping on our local machines. We found
a bunch of timezone-related bugs for instance.</p>

<p>The plus side is that once everything is in place, it&#8217;s really
comfortable to program. We share the same cursor, the same window,
there is not compression artifacts, and all is super fast.</p>

<p>This is clearly the best solution we have found so far. Plus it&#8217;s a
really geeky one, and we get to learn tmux along the way.</p>

<h3>Pros:</h3>

<ul>
<li>Fast</li>
<li>Convinient</li>
<li>Geeky</li>
</ul>


<h3>Cons:</h3>

<ul>
<li>A lot of configuration</li>
<li>No support for sublime text 2</li>
<li>Weird scrolling with tmux</li>
</ul>


<h2>Conclusion</h2>

<p>We&#8217;re still kind of green in the field of remote pair programming, but
we found a pretty good solution for now. There is clearly room for
improvement, but remote pair programming feels pretty much like local
pair programming (even arguably better).</p>
<div class='octopress-authorbox'>
  <div class="author-pic">
    <img src="http://www.gravatar.com/avatar/c7a730fdb6c64f65ff18a5e74e60b4df" alt="Jean-Louis Giordano" />
  </div>

  <div class="author-about">
    <h3>Jean-Louis Giordano</h3>
    <ul class="author-links">
      
      <li>Passionate Developer</li>
      

      
      <li><a href="mailto: ">jean-louis@pugglepay.com</a></li>
      

      
      <li>
        <a href="https://twitter.com/jellismymind" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @jellismymind</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      
    </ul>
  </div>
</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Torquebox or: How I Learned to Stop Worrying and Love the JVM]]></title>
    <link href="http://devblog.pugglepay.com/blog/2013/05/03/torquebox-or-how-i-learned-to-stop-worrying-and-love-the-jvm/"/>
    <updated>2013-05-03T10:42:00+02:00</updated>
    <id>http://devblog.pugglepay.com/blog/2013/05/03/torquebox-or-how-i-learned-to-stop-worrying-and-love-the-jvm</id>
    <content type="html"><![CDATA[<p>So here is the thing. As a DevOp, SysAdmin is a PITA. Time spent
tweaking the servers to add such or such service is time not spent
actually producing value.</p>

<p>At PugglePay, we try to be agile and always look at the trade-offs
that are involved in every decision we make. So as we started
developing our product, we decided to go with the easy and fast track,
and that meant Amazon, Rails and MySQL.</p>

<p>Unfortunately, easy does not necessary mean simple, so we kept using
the same tools to the point where easy became complex. It was time
for us to do something difficult which was to use more tools and turn our
architecture simple again.</p>

<!-- more -->


<p>The difficult thing for us was to move out of our comfort zone because
our comfort zone was a dangerous place (remember the frog being slowly
boiled to death).</p>

<h2>Our problem:</h2>

<ul>
<li><p>We needed queues. We kept on postponing using them because we wanted
to Keep It Simple™, but simple meant using queues.</p></li>
<li><p>We needed daemons. Stuff that run non stop, and that get updated
after each deploy.</p></li>
<li><p>We needed scheduled jobs. We used cron for that, but that meant
the application and the server were tightly coupled. Not simple!
(but easy)</p></li>
</ul>


<p>If we look at all of the above, the easy solution would have been to
add a message processing lib like sidekiq, a short capistrano script
to redeploy our services and keep on using cron for recurring tasks.
But here comes the trick:</p>

<ul>
<li>We are going to need clustering. And we want all of the above to be
clustered.</li>
</ul>


<p>So as any good developer, we googled &#8220;rails queues cron clustering&#8221;
and found <a href="http://torquebox.org/">TorqueBox</a>.</p>

<h2>TorqueBox</h2>

<p>The idea of TorqueBox is to add a layer of abstraction between the
server and your application. It&#8217;s like you are building a city, and
TorqueBox offers to provide the sewer system, running water,
electricity and the Internet so that you can focus on the city
planning.</p>

<p>In practice, that meant webserver, messaging, recurring jobs, and
daemons out of the box, and the only SysAdmin we have to take care of
is to get TorqueBox running.</p>

<p>Wow. That looked exactly like what we needed. Only downside: it runs on
JRuby. Which means JVM. And we had zero knowledge.</p>

<p>But the concept was just too good to be so easily dismissed because of our
own lack of knowledge. It would be difficult for us, but it could
become easy on the long run.</p>

<h2>Investigation</h2>

<p>So we started our investigation. The first step was to migrate our app
to JRuby. First downside: we got really slow tests. So that&#8217;s the
first thing we had to improve.</p>

<p>The solution was to use <a href="https://github.com/sporkrb/spork">Spork</a> and
NailGun. What we got are fast enough tests. It&#8217;s slower than with MRI
(10% slower on average), but good enough.</p>

<p>So running on JRuby: check! Next step was to get the app running
locally on TorqueBox. Roughly, that meant:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>gem install torquebox
</span><span class='line'>torquebox run
</span><span class='line'>torquebox deploy
</span></code></pre></td></tr></table></div></figure>


<p>Boom. Trivial. Now let&#8217;s deploy to Amazon. Well, there&#8217;s a
<a href="https://github.com/torquebox/chef-cookbooks">chef recipe</a>. It
requires some extra work to get clustering going because Amazon does
not support multicasting (for automatic discovery of new nodes). Well,
clustering is for later, and for sure we&#8217;re going to solve that
problem. So getting TorqueBox to run on Amazon: check!</p>

<p>Now let&#8217;s deploy. Cool, there&#8217;s a
<a href="https://rubygems.org/gems/torquebox-capistrano-support">Capistrano recipe</a>!
We already used capistrano, so that was easy. Boom! Deploying to
TorqueBox: check!</p>

<p>Sweet! Now lets deploy again! Yay, it works! And again! Yay! And
again! Oups&#8230; Nothing works anymore. Well, we knew exactly nothing
about JRuby, the JVM or TorqueBox, so it took us a week to find out
that after a redeploy the connections to the database were only closed
after Garbage Collection, but garbage collection came too late in our
case.</p>

<p>So the solution was to add an <code>at_exit</code> hook that took care of closing
all connections after redeploy.</p>

<p>We also realized that we do not get zero-downtime deploy when
deploying to TorqueBox. That&#8217;s sad, because we are going to need it in
the future. After googling a little more, we found out that this is a
feature coming with the next release. Fair enough.</p>

<p>So after a couple of weeks of research and testing, we were confident
enough that TorqueBox would make our system much easier to maintain in
the future, and decided that the pros were bigger than the cons.</p>

<p>So we took a leap of faith and deployed the whole thing in production.</p>

<h2>Running in production</h2>

<p>It went pretty smoothly at first, but after a couple of deploy we got
a &#8220;PermGen out of memory&#8221; error. WTF is that?</p>

<p>Well, that&#8217;s a story for another post. Long story short, closing the
DB connections was not enough because some references were being kept
that prevented the JRuby runtimes from being garbage collected after
each deploy. Also <code>jvisualvm</code> is an awesome tool that lets you inspect
a running JVM in realtime.</p>

<p>We have been running TorqueBox in production for a couple of weeks now,
and we are getting more familiar with it everyday. Our architecture is
much simpler, and the difficult bump we had to overcome is behind us.
So in the end, we believe that we have made the right choice.</p>

<p>But I think it is important to know that this was not a totally
painless migration. We had to learn about the JVM, how its garbage
collection works, which tool to use and which flags to set, while
making sure our development speed was not too much impacted by the
change. For us, it was worth it because we needed a better
infrastructure, and we did not want to rely on too many components.</p>

<h2>Conclusion</h2>

<p>Pros > Cons, lots of new things to learn, but the end
result is a simpler architecture.</p>

<p>We&#8217;d love to share more of what we know, but we&#8217;d love even more to
acquire knowledge from others. So if you have some experience with
TorqueBox, please get in touch!</p>
<div class='octopress-authorbox'>
  <div class="author-pic">
    <img src="http://www.gravatar.com/avatar/c7a730fdb6c64f65ff18a5e74e60b4df" alt="Jean-Louis Giordano" />
  </div>

  <div class="author-about">
    <h3>Jean-Louis Giordano</h3>
    <ul class="author-links">
      
      <li>Passionate Developer</li>
      

      
      <li><a href="mailto: ">jean-louis@pugglepay.com</a></li>
      

      
      <li>
        <a href="https://twitter.com/jellismymind" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @jellismymind</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      
    </ul>
  </div>
</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[spork_and_nailgun.el]]></title>
    <link href="http://devblog.pugglepay.com/blog/2013/05/02/spork-and-nailgun-dot-el/"/>
    <updated>2013-05-02T23:31:00+02:00</updated>
    <id>http://devblog.pugglepay.com/blog/2013/05/02/spork-and-nailgun-dot-el</id>
    <content type="html"><![CDATA[<p>We recently made the shift to TorqueBox here at PugglePay, and that
meant moving from MRI to JRuby. I order to cope with the slow start-up
induced by the JVM we started using spork and nailgun for running our
tests.</p>

<p><a href="https://github.com/sporkrb/spork">Spork</a> preloads instances of your
application for you to have faster startup for your tests. And nailgun
(wich comes with JRuby) is a lower level tool to have jvm instances
ready to go.</p>

<p>Both of them stay alive between test runs and can get &#8220;corrupted&#8221;. You
also need to restart spork every time you change something that is
outside what it reloads between each test (blueprints for example in
our case).</p>

<p>So we (eq me and Jean-Louis) decided to spend an hour to make this a
bit easier. With the answer to all technical problems!</p>

<!-- more -->


<h3><a href="https://github.com/PugglePay/spork-and-nailgun.el">An Emacs Plugin</a></h3>

<p>So install it (with <a href="https://github.com/dimitri/el-get">el-get</a> perhaps) and bind a key (ex <code>C-c C-l</code>) to &#8216;sang-start-all and run it.</p>

<ul>
<li>It will kill any running instances of spork and nailgun you have
running (by looking up the port they are listening to),</li>
<li>Jump to the root of the project your currently editing in and
activate the right rvm env,</li>
<li>Start upp Spork and nailgun in separate buffers.</li>
</ul>


<p>The spork buffer will popup and it can have some useful information if
you have some errors.</p>

<p><a href="http://imgur.com/RozzIIv"><img src="http://i.imgur.com/RozzIIv.png" title="Hosted by imgur.com"/></a></p>

<p>Now your ready to run your tests with <a href="https://github.com/pezra/rspec-mode"><code>C-c , v</code></a></p>

<p>This plugin works well for our workflow so <a href="https://github.com/PugglePay/spork-and-nailgun.el">try it out</a> yourself.</p>
<div class='octopress-authorbox'>
  <div class="author-pic">
    <img src="https://secure.gravatar.com/avatar/d7e5aaa6813cde9cbd0005a2cf2b56f1?d=https://d3levm2kxut31z.cloudfront.net/assets/blank-mugshot-112e2e92d74b7344b8be3630bbccc5da.png" alt="Patrik Kårlin" />
  </div>

  <div class="author-about">
    <h3>Patrik Kårlin</h3>
    <ul class="author-links">
      
      <li>System Developer</li>
      

      
      <li><a href="mailto: ">patrik@pugglepay.com</a></li>
      

      
      <li>
        <a href="https://twitter.com/patrik_karlin" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @patrik_karlin</a>
        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      </li>
      
    </ul>
  </div>
</div>
]]></content>
  </entry>
  
</feed>
